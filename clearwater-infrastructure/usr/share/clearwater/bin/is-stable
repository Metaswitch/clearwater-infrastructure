#!/bin/sh

# @file is-stable
#
# Copyright (C) Metaswitch Networks 2017
# If license terms are provided to you in a COPYING file in the root directory
# of the source code repository by which you are accessing this code, then
# the license outlined in that COPYING file applies to your use.
# Otherwise no rights are granted except for those provided to you by
# Metaswitch Networks in a separate written agreement.

# Checks that a process has been running for at least REQUIRED_UPTIME
# seconds. Returns 0 if it has. Returns a non-zero value if it has not.

[ $# = 2 ] || { echo "Usage: check-uptime-no-alarm <pidfile> <required uptime(s)>" >&2 ; exit 2; }
pidfile=$1
required_uptime=$2

# It's expected that there might not be a pidfile
pid=$( cat $pidfile 2>/dev/null)

uptime=$( ps -p $pid -o etimes= 2>/dev/null) || { echo -n "No process matching value from pidfile: $pid " >&2 ; exit 1 ; }
if [ "$uptime" -ge "$required_uptime" ]; then
  exit 0
else
  exit 1
fi
